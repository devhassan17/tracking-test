<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Website</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        header {
            background: #007BFF;
            color: white;
            padding: 10px 20px;
            text-align: center;
        }

        main {
            padding: 20px;
            text-align: center;
        }

        footer {
            background: #f4f4f4;
            color: #333;
            text-align: center;
            padding: 10px;
            margin-top: 20px;
        }
    </style>
<!-- Include Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://www.google.com/recaptcha/enterprise.js?render=6LfKxIcqAAAAAL8e5CJP0PiZeD5rwuDwalyYnnl4"></script>

<script>
    // Initialize reCAPTCHA
    async function initializeReCaptcha(action) {
        grecaptcha.enterprise.ready(() => 
            grecaptcha.enterprise.execute('6LfKxIcqAAAAAL8e5CJP0PiZeD5rwuDwalyYnnl4', { action })
        );
    }

    // Send tracking data
    function sendTrackingData(type, ip, country) {
        fetch('http://127.0.0.1:8000/track-click/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ type, hash: "2", ip, country }),
        }).catch(err => console.error('Error tracking:', err));
    }

    // Fetch IP Info
    function fetchIPInfo() {
        return fetch('https://ipinfo.io/json?token=4b143e6e51301d')
            .then(res => res.json())
            .then(data => ({ ip: data.ip, country: data.country }))
            .catch(err => console.error('Error fetching IP info:', err));
    }

    // Initialize Chat Button & Panel
    function setupChat(ip, country) {
        const chatButton = `<button id="chatBtn" class="btn btn-primary position-fixed" style="top: 50%; right: 18px; transform: rotate(-90deg);">Chat</button>`;
        const chatPanel = `
            <div id="chatPanel" class="card position-fixed shadow" style="top: 50%; right: -310px; width: 300px; transition: right 0.3s;">
                <div class="card-body">
                    <p>Book an appointment with our students or alumni?</p>
                    <button id="yesBtn" class="btn btn-success me-2">Yes</button>
                    <button id="noBtn" class="btn btn-danger">No</button>
                    <div class="text-center mt-3">
                        <a href="https://www.applypal.io/" target="_blank" class="text-muted small">Powered by TAG</a>
                    </div>
                </div>
            </div>
        `;
        document.body.insertAdjacentHTML('beforeend', chatButton + chatPanel);

        // Event Listeners
        document.getElementById('chatBtn').onclick = () => {
            initializeReCaptcha('LOGIN');
            document.getElementById('chatPanel').style.right = '0';
            sendTrackingData('chat', ip, country);
        };

        document.getElementById('yesBtn').onclick = () => {
            window.open('https://mail.google.com/mail/u/0/#inbox', '_blank');
            sendTrackingData('calendly', ip, country);
        };

        document.getElementById('noBtn').onclick = () => {
            document.getElementById('chatPanel').style.right = '-310px';
            sendTrackingData('no', ip, country);
        };
    }

    // Initialize on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
        fetchIPInfo().then(({ ip, country }) => setupChat(ip, country));
    });
</script>

    
    
</head>
<body>
    <header>
        <h1>Welcome to Our Simple Website</h1>
    </header>
    <main>
        <p>This is a simple website with a single home page. It includes an interactive button for connecting with us.</p>
        <p>Explore and enjoy!</p>
    </main>
    <footer>
        <p>&copy; 2024 Simple Website. All rights reserved.</p>
    </footer>
</body>
</html>

